name: Create Copilot Coding Task

on:
  workflow_dispatch:
    inputs:
      task_description:
        description: 'What should Copilot build/fix?'
        required: true
        default: 'Refactor Sample.cs methods to use PascalCase naming convention'

permissions:
  issues: write
  contents: read

jobs:
  create-task:
    runs-on: ubuntu-latest
    
    steps:
      - name: Fetch coding guidelines
        run: |
          curl -s https://raw.githubusercontent.com/antoleandarius/dotnet-guidelines-poc/main/naming.md -o guidelines.md

      - name: Create GitHub Issue for Copilot
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          cat > issue-body.md << 'ISSUE_EOF'
          ## ðŸ¤– Automated Coding Task

          ### Task Description
          ${{ inputs.task_description }}

          ---

          ### ðŸ“‹ Coding Guidelines to Follow
          
          ISSUE_EOF
          
          cat guidelines.md >> issue-body.md
          
          cat >> issue-body.md << 'ISSUE_EOF'

          ---

          ### Instructions for GitHub Copilot
          - Implement the changes described above
          - Follow all naming conventions strictly
          - Ensure methods use PascalCase
          - Create a PR when complete

          @copilot please implement this task following the guidelines above.
          ISSUE_EOF
          
          gh issue create \
            --repo ${{ github.repository }} \
            --title "Copilot Task: ${{ inputs.task_description }}" \
            --body-file issue-body.md
